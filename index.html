<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Class Attendance</title>
  <style>
    body{font-family:Arial;margin:20px auto;max-width:900px;}
    h1{margin-bottom:10px;}
    .card{border:1px solid #ddd;padding:12px;border-radius:8px;margin-bottom:12px;}
    label{display:block;margin:6px 0 3px;font-weight:600;}
    input,select,button{padding:7px;border:1px solid #ccc;border-radius:5px;}
    .row{display:flex;gap:10px;margin-bottom:10px;}
    table{width:100%;border-collapse:collapse;margin-top:12px;}
    th,td{border:1px solid #ddd;padding:6px;text-align:left;}
    .actions{margin-top:8px;display:flex;gap:8px;}
  </style>
</head>
<body>
  <h1>Class Data â€” Attendance</h1>
  <div class="card">
    <div class="row">
      <div>
        <label>Date</label>
        <input type="date" id="date"/>
      </div>
      <div>
        <label>Day</label>
        <select id="day">
          <option>Monday</option><option>Tuesday</option><option>Wednesday</option>
          <option>Thursday</option><option>Friday</option><option>Saturday</option><option>Sunday</option>
        </select>
      </div>
    </div>

    <label>Batch</label>
    <select id="batch">
      <option>Batch 1 (7:30-8:30pm)</option>
      <option>Batch 2 (8:30-9:30pm)</option>
    </select>

    <label>Student</label>
    <input id="student" placeholder="Enter student name"/>

    <div class="actions">
      <button onclick="addRecord()">Add Record</button>
      <button onclick="clearRecords()">Clear All</button>
      <button onclick="exportCSV()">Export CSV</button>
    </div>
  </div>

  <div class="card">
    <h3>Saved Records</h3>
    <table>
      <thead><tr><th>#</th><th>Date</th><th>Day</th><th>Batch</th><th>Student</th><th>Saved At</th></tr></thead>
      <tbody id="recordsBody"></tbody>
    </table>
  </div>

<script>
const API_URL = "http://localhost:5000/api/records";

async function loadRecords(){
  const res = await fetch(API_URL);
  const data = await res.json();
  const tbody = document.getElementById("recordsBody");
  tbody.innerHTML = "";
  data.forEach((r,i)=>{
    tbody.innerHTML += `<tr>
      <td>${i+1}</td><td>${r.date}</td><td>${r.day}</td>
      <td>${r.batch}</td><td>${r.student}</td><td>${r.savedAt}</td>
    </tr>`;
  });
}

async function addRecord(){
  const date = document.getElementById("date").value;
  const day = document.getElementById("day").value;
  const batch = document.getElementById("batch").value;
  const student = document.getElementById("student").value.trim();
  if(!date || !student){ alert("Enter Date & Student"); return; }
  const savedAt = new Date().toLocaleString();
  await fetch(API_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({date,day,batch,student,savedAt})
  });
  document.getElementById("student").value="";
  loadRecords();
}

async function clearRecords(){
  if(!confirm("Clear all records?")) return;
  await fetch(API_URL,{method:"DELETE"});
  loadRecords();
}

async function exportCSV(){
  const res = await fetch(API_URL);
  const data = await res.json();
  if(data.length===0){alert("No data");return;}
  const header = ["Date","Day","Batch","Student","SavedAt"];
  const rows = data.map(r=>[r.date,r.day,r.batch,r.student,r.savedAt]);
  const csv = [header,...rows].map(e=>e.join(",")).join("\n");
  const blob = new Blob([csv],{type:"text/csv"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download="records.csv"; a.click();
  URL.revokeObjectURL(url);
}

loadRecords();
</script>
</body>
</html>
